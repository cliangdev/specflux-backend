openapi: 3.1.0
info:
  title: SpecFlux API
  description: |
    REST API for SpecFlux - AI-Powered Multi-Repo Development Orchestrator.

    SpecFlux transforms "vibe coding" into disciplined, spec-driven engineering by providing:
    - Unified Kanban board for multi-repo project management
    - Automatic Claude Code agent launching with context injection
    - Human-in-the-loop approval workflows

    ## Authentication
    All API endpoints (except health checks and documentation) require Firebase JWT authentication.
    Include the Firebase ID token in the `Authorization` header as a Bearer token.

    ## Error Responses
    All endpoints return consistent error responses with `code`, `message`, and optional `details` fields.
  version: 1.0.0
  contact:
    name: SpecFlux Team
    url: https://github.com/cliangdev/specflux
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

externalDocs:
  description: SpecFlux Documentation
  url: https://github.com/cliangdev/specflux

servers:
  - url: http://localhost:8090/api
    description: Local development server
  - url: https://api.specflux.dev/api
    description: Production server (coming soon)

security:
  - bearerAuth: []

tags:
  - name: Projects
    description: |
      Project management endpoints.
      Projects are top-level containers that group related epics and tasks across multiple repositories.
  - name: PRDs
    description: |
      PRD (Product Requirements Document) management endpoints.
      PRDs define product specifications and can contain multiple supporting documents (wireframes, mockups, etc.).
  - name: Epics
    description: |
      Epic management endpoints.
      Epics represent large features or initiatives containing multiple tasks with a PRD (Product Requirements Document).
  - name: Tasks
    description: |
      Task management endpoints.
      Tasks are individual work units executed by Claude Code agents, with status tracking and dependencies.
  - name: Releases
    description: |
      Release/milestone management endpoints.
      Releases group completed epics and tasks into versioned milestones for deployment tracking.
  - name: Users
    description: |
      User profile management endpoints.
      Users are auto-provisioned on first Firebase authentication (GitHub OAuth).
  - name: Repositories
    description: |
      Repository management endpoints.
      Repositories are Git repositories associated with a project.
  - name: Skills
    description: |
      Skill management endpoints.
      Skills are Claude Code skill definitions stored in .claude/skills/.
  - name: Agents
    description: |
      Agent management endpoints.
      Agents are Claude Code agent definitions stored in .claude/agents/.
  - name: McpServers
    description: |
      MCP Server management endpoints.
      MCP servers are Model Context Protocol servers configured in .claude/.mcp.json.
  - name: GitHub
    description: |
      GitHub App integration endpoints.
      Handles OAuth installation flow and repository creation for project cloud sync.
  - name: ApiKeys
    description: |
      API key management endpoints.
      Allows users to create and manage API keys for programmatic access (e.g., Claude Code integration).

paths:
  # ==================== PROJECTS ====================
  /api/projects:
    get:
      operationId: listProjects
      summary: List user's projects
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/CursorParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
      responses:
        '200':
          description: List of projects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      operationId: createProject
      summary: Create a new project
      tags: [Projects]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/projects/{ref}:
    parameters:
      - name: ref
        in: path
        required: true
        description: Project public ID (proj_xxx) or project key (SPEC)
        schema:
          type: string

    get:
      operationId: getProject
      summary: Get a project
      tags: [Projects]
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateProject
      summary: Update a project
      tags: [Projects]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectRequest'
      responses:
        '200':
          description: Project updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteProject
      summary: Delete a project
      tags: [Projects]
      responses:
        '204':
          description: Project deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== PRDS ====================
  /api/projects/{projectRef}/prds:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listPrds
      summary: List PRDs in a project
      tags: [PRDs]
      parameters:
        - $ref: '#/components/parameters/CursorParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/PrdStatus'
      responses:
        '200':
          description: List of PRDs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrdListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createPrd
      summary: Create a new PRD
      tags: [PRDs]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePrdRequest'
      responses:
        '201':
          description: PRD created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Prd'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectRef}/prds/{prdRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: prdRef
        in: path
        required: true
        description: PRD public ID (prd_xxx) or display key (SPEC-P1)
        schema:
          type: string

    get:
      operationId: getPrd
      summary: Get a PRD with its documents
      tags: [PRDs]
      responses:
        '200':
          description: PRD details including documents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Prd'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updatePrd
      summary: Update a PRD
      tags: [PRDs]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePrdRequest'
      responses:
        '200':
          description: PRD updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Prd'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deletePrd
      summary: Delete a PRD
      tags: [PRDs]
      responses:
        '204':
          description: PRD deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== PRD DOCUMENTS ====================
  /api/projects/{projectRef}/prds/{prdRef}/documents:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: prdRef
        in: path
        required: true
        schema:
          type: string

    post:
      operationId: addPrdDocument
      summary: Add a document to a PRD
      tags: [PRDs]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddPrdDocumentRequest'
      responses:
        '201':
          description: Document added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Prd'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/projects/{projectRef}/prds/{prdRef}/documents/{docId}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: prdRef
        in: path
        required: true
        schema:
          type: string
      - name: docId
        in: path
        required: true
        description: Document ID
        schema:
          type: integer
          format: int64

    put:
      operationId: updatePrdDocument
      summary: Update a PRD document's metadata
      tags: [PRDs]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePrdDocumentRequest'
      responses:
        '200':
          description: Document updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Prd'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deletePrdDocument
      summary: Remove a document from a PRD
      tags: [PRDs]
      responses:
        '204':
          description: Document removed
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== EPICS ====================
  /api/projects/{projectRef}/epics:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listEpics
      summary: List epics in a project
      tags: [Epics]
      parameters:
        - $ref: '#/components/parameters/CursorParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/EpicStatus'
        - name: prdRef
          in: query
          description: Filter by PRD (public ID or display key)
          schema:
            type: string
        - name: releaseRef
          in: query
          description: Filter by Release (public ID or display key)
          schema:
            type: string
      responses:
        '200':
          description: List of epics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EpicListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createEpic
      summary: Create a new epic
      tags: [Epics]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEpicRequest'
      responses:
        '201':
          description: Epic created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Epic'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectRef}/epics/{epicRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: epicRef
        in: path
        required: true
        description: Epic public ID (epic_xxx) or display key (SPEC-E1)
        schema:
          type: string

    get:
      operationId: getEpic
      summary: Get an epic
      tags: [Epics]
      responses:
        '200':
          description: Epic details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Epic'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateEpic
      summary: Update an epic
      tags: [Epics]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEpicRequest'
      responses:
        '200':
          description: Epic updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Epic'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteEpic
      summary: Delete an epic
      tags: [Epics]
      responses:
        '204':
          description: Epic deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== TASKS ====================
  /api/projects/{projectRef}/tasks:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listTasks
      summary: List tasks in a project
      tags: [Tasks]
      parameters:
        - $ref: '#/components/parameters/CursorParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/TaskStatus'
        - name: priority
          in: query
          schema:
            $ref: '#/components/schemas/TaskPriority'
        - name: epicRef
          in: query
          description: Filter by epic (public ID or display key)
          schema:
            type: string
        - name: assignedToRef
          in: query
          description: Filter by assignee (user public ID)
          schema:
            type: string
        - name: search
          in: query
          description: Search in title and description
          schema:
            type: string
      responses:
        '200':
          description: List of tasks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createTask
      summary: Create a new task
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTaskRequest'
      responses:
        '201':
          description: Task created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectRef}/tasks/{taskRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: taskRef
        in: path
        required: true
        description: Task public ID (task_xxx) or display key (SPEC-42)
        schema:
          type: string

    get:
      operationId: getTask
      summary: Get a task
      tags: [Tasks]
      responses:
        '200':
          description: Task details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      operationId: updateTask
      summary: Partially update a task
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTaskRequest'
      responses:
        '200':
          description: Task updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteTask
      summary: Delete a task
      tags: [Tasks]
      responses:
        '204':
          description: Task deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== TASK DEPENDENCIES ====================
  /api/projects/{projectRef}/tasks/{taskRef}/dependencies:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: taskRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listTaskDependencies
      summary: List dependencies for a task
      description: Returns tasks that this task depends on (blockers)
      tags: [Tasks]
      responses:
        '200':
          description: List of task dependencies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDependencyListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: addTaskDependency
      summary: Add a dependency to a task
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddTaskDependencyRequest'
      responses:
        '201':
          description: Dependency added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDependency'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/projects/{projectRef}/tasks/{taskRef}/dependencies/{dependsOnTaskRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: taskRef
        in: path
        required: true
        schema:
          type: string
      - name: dependsOnTaskRef
        in: path
        required: true
        description: Task reference that this task depends on
        schema:
          type: string

    delete:
      operationId: removeTaskDependency
      summary: Remove a dependency from a task
      tags: [Tasks]
      responses:
        '204':
          description: Dependency removed
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== TASK ACCEPTANCE CRITERIA ====================
  /api/projects/{projectRef}/tasks/{taskRef}/acceptance-criteria:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: taskRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listTaskAcceptanceCriteria
      summary: List acceptance criteria for a task
      tags: [Tasks]
      responses:
        '200':
          description: List of acceptance criteria
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcceptanceCriteriaListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createTaskAcceptanceCriteria
      summary: Add acceptance criteria to a task
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAcceptanceCriteriaRequest'
      responses:
        '201':
          description: Acceptance criteria created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcceptanceCriteria'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectRef}/tasks/{taskRef}/acceptance-criteria/{criteriaId}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: taskRef
        in: path
        required: true
        schema:
          type: string
      - name: criteriaId
        in: path
        required: true
        description: Acceptance criteria ID
        schema:
          type: integer
          format: int64

    get:
      operationId: getTaskAcceptanceCriteria
      summary: Get a specific acceptance criteria for a task
      tags: [Tasks]
      responses:
        '200':
          description: Acceptance criteria details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcceptanceCriteria'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateTaskAcceptanceCriteria
      summary: Update acceptance criteria for a task
      tags: [Tasks]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAcceptanceCriteriaRequest'
      responses:
        '200':
          description: Acceptance criteria updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcceptanceCriteria'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteTaskAcceptanceCriteria
      summary: Delete acceptance criteria from a task
      tags: [Tasks]
      responses:
        '204':
          description: Acceptance criteria deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== EPIC ACCEPTANCE CRITERIA ====================
  /api/projects/{projectRef}/epics/{epicRef}/acceptance-criteria:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: epicRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listEpicAcceptanceCriteria
      summary: List acceptance criteria for an epic
      tags: [Epics]
      responses:
        '200':
          description: List of acceptance criteria
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcceptanceCriteriaListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createEpicAcceptanceCriteria
      summary: Add acceptance criteria to an epic
      tags: [Epics]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAcceptanceCriteriaRequest'
      responses:
        '201':
          description: Acceptance criteria created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcceptanceCriteria'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectRef}/epics/{epicRef}/acceptance-criteria/{criteriaId}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: epicRef
        in: path
        required: true
        schema:
          type: string
      - name: criteriaId
        in: path
        required: true
        description: Acceptance criteria ID
        schema:
          type: integer
          format: int64

    get:
      operationId: getEpicAcceptanceCriteria
      summary: Get a specific acceptance criteria for an epic
      tags: [Epics]
      responses:
        '200':
          description: Acceptance criteria details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcceptanceCriteria'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateEpicAcceptanceCriteria
      summary: Update acceptance criteria for an epic
      tags: [Epics]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAcceptanceCriteriaRequest'
      responses:
        '200':
          description: Acceptance criteria updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AcceptanceCriteria'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteEpicAcceptanceCriteria
      summary: Delete acceptance criteria from an epic
      tags: [Epics]
      responses:
        '204':
          description: Acceptance criteria deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== EPIC TASKS ====================
  /api/projects/{projectRef}/epics/{epicRef}/tasks:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: epicRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listEpicTasks
      summary: List tasks in an epic
      tags: [Epics]
      parameters:
        - $ref: '#/components/parameters/CursorParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: status
          in: query
          description: Filter by task status
          schema:
            $ref: '#/components/schemas/TaskStatus'
      responses:
        '200':
          description: List of tasks in the epic
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== EPIC DEPENDENCIES ====================
  /api/projects/{projectRef}/epics/{epicRef}/dependencies:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: epicRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listEpicDependencies
      summary: List epics this epic depends on
      tags: [Epics]
      responses:
        '200':
          description: List of dependency epics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EpicListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: addEpicDependency
      summary: Add a dependency to an epic
      tags: [Epics]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                dependsOnEpicRef:
                  type: string
                  description: Public ID or display key of the epic to depend on
              required:
                - dependsOnEpicRef
      responses:
        '201':
          description: Dependency added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Epic'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/projects/{projectRef}/epics/{epicRef}/dependencies/{depEpicRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: epicRef
        in: path
        required: true
        schema:
          type: string
      - name: depEpicRef
        in: path
        required: true
        description: Dependency epic public ID or display key
        schema:
          type: string

    delete:
      operationId: removeEpicDependency
      summary: Remove a dependency from an epic
      tags: [Epics]
      responses:
        '204':
          description: Dependency removed
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== RELEASES ====================
  /api/projects/{projectRef}/releases:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listReleases
      summary: List releases in a project
      tags: [Releases]
      parameters:
        - $ref: '#/components/parameters/CursorParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/ReleaseStatus'
      responses:
        '200':
          description: List of releases
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createRelease
      summary: Create a new release
      tags: [Releases]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReleaseRequest'
      responses:
        '201':
          description: Release created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Release'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectRef}/releases/{releaseRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: releaseRef
        in: path
        required: true
        description: Release public ID (rel_xxx) or display key (SPEC-R1)
        schema:
          type: string

    get:
      operationId: getRelease
      summary: Get a release
      tags: [Releases]
      parameters:
        - name: include
          in: query
          required: false
          description: |
            Comma-separated list of nested resources to include:
            - epics: Include all epics in this release
            - tasks: Include tasks within each epic (requires epics)
            Example: include=epics,tasks
          schema:
            type: string
      responses:
        '200':
          description: Release details (with optional nested epics/tasks based on include param)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseWithEpics'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateRelease
      summary: Update a release
      tags: [Releases]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateReleaseRequest'
      responses:
        '200':
          description: Release updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Release'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteRelease
      summary: Delete a release
      tags: [Releases]
      responses:
        '204':
          description: Release deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== USERS ====================
  /api/users/me:
    get:
      operationId: getCurrentUser
      summary: Get current authenticated user
      description: |
        Returns the profile of the currently authenticated user.
        Auto-provisions the user on first call if not exists.
      tags: [Users]
      responses:
        '200':
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

    put:
      operationId: updateCurrentUser
      summary: Update current user profile
      description: Update the display name and/or avatar URL of the current user.
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/users/{ref}:
    parameters:
      - name: ref
        in: path
        required: true
        description: User public ID (usr_xxx)
        schema:
          type: string

    get:
      operationId: getUser
      summary: Get user by public ID
      description: Lookup a user by their public ID. Used for member lookup in project collaboration.
      tags: [Users]
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== REPOSITORIES ====================
  /api/projects/{projectRef}/repositories:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listRepositories
      summary: List repositories in a project
      tags: [Repositories]
      responses:
        '200':
          description: List of repositories
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RepositoryListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createRepository
      summary: Add a repository to a project
      tags: [Repositories]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRepositoryRequest'
      responses:
        '201':
          description: Repository created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Repository'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/projects/{projectRef}/repositories/{repoRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: repoRef
        in: path
        required: true
        description: Repository public ID (repo_xxx)
        schema:
          type: string

    get:
      operationId: getRepository
      summary: Get a repository
      tags: [Repositories]
      responses:
        '200':
          description: Repository details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Repository'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateRepository
      summary: Update a repository
      tags: [Repositories]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRepositoryRequest'
      responses:
        '200':
          description: Repository updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Repository'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteRepository
      summary: Remove a repository from a project
      tags: [Repositories]
      responses:
        '204':
          description: Repository deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== SKILLS ====================
  /api/projects/{projectRef}/skills:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listSkills
      summary: List skills in a project
      tags: [Skills]
      responses:
        '200':
          description: List of skills
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SkillListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createSkill
      summary: Add a skill to a project
      tags: [Skills]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSkillRequest'
      responses:
        '201':
          description: Skill created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Skill'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/projects/{projectRef}/skills/{skillRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: skillRef
        in: path
        required: true
        description: Skill public ID (skill_xxx)
        schema:
          type: string

    get:
      operationId: getSkill
      summary: Get a skill
      tags: [Skills]
      responses:
        '200':
          description: Skill details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Skill'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateSkill
      summary: Update a skill
      tags: [Skills]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSkillRequest'
      responses:
        '200':
          description: Skill updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Skill'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteSkill
      summary: Remove a skill from a project
      tags: [Skills]
      responses:
        '204':
          description: Skill deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== AGENTS ====================
  /api/projects/{projectRef}/agents:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listAgents
      summary: List agents in a project
      tags: [Agents]
      responses:
        '200':
          description: List of agents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createAgent
      summary: Add an agent to a project
      tags: [Agents]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAgentRequest'
      responses:
        '201':
          description: Agent created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/projects/{projectRef}/agents/{agentRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: agentRef
        in: path
        required: true
        description: Agent public ID (agent_xxx)
        schema:
          type: string

    get:
      operationId: getAgent
      summary: Get an agent
      tags: [Agents]
      responses:
        '200':
          description: Agent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateAgent
      summary: Update an agent
      tags: [Agents]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentRequest'
      responses:
        '200':
          description: Agent updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteAgent
      summary: Remove an agent from a project
      tags: [Agents]
      responses:
        '204':
          description: Agent deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== MCP SERVERS ====================
  /api/projects/{projectRef}/mcp-servers:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string

    get:
      operationId: listMcpServers
      summary: List MCP servers in a project
      tags: [McpServers]
      responses:
        '200':
          description: List of MCP servers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpServerListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      operationId: createMcpServer
      summary: Add an MCP server to a project
      tags: [McpServers]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMcpServerRequest'
      responses:
        '201':
          description: MCP server created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpServer'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/projects/{projectRef}/mcp-servers/{serverRef}:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: serverRef
        in: path
        required: true
        description: MCP server public ID (mcp_xxx)
        schema:
          type: string

    get:
      operationId: getMcpServer
      summary: Get an MCP server
      tags: [McpServers]
      responses:
        '200':
          description: MCP server details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpServer'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateMcpServer
      summary: Update an MCP server
      tags: [McpServers]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMcpServerRequest'
      responses:
        '200':
          description: MCP server updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpServer'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deleteMcpServer
      summary: Remove an MCP server from a project
      tags: [McpServers]
      responses:
        '204':
          description: MCP server deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/projects/{projectRef}/mcp-servers/{serverRef}/toggle:
    parameters:
      - name: projectRef
        in: path
        required: true
        schema:
          type: string
      - name: serverRef
        in: path
        required: true
        schema:
          type: string

    post:
      operationId: toggleMcpServer
      summary: Toggle MCP server active status
      tags: [McpServers]
      responses:
        '200':
          description: MCP server toggled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpServer'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ==================== GITHUB ====================
  /api/github/install:
    get:
      operationId: initiateGithubInstall
      summary: Initiate GitHub App installation
      description: |
        Returns the GitHub OAuth URL for the user to authorize the SpecFlux GitHub App.
        The client should open this URL in a browser to complete the OAuth flow.
        For desktop apps, pass redirect_uri to receive the callback on a local server.
      tags: [GitHub]
      parameters:
        - name: redirect_uri
          in: query
          required: false
          schema:
            type: string
            format: uri
          description: |
            URL to redirect to after OAuth completes. Used by desktop apps to
            redirect back to a local server (e.g., http://localhost:8765).
            If not provided, redirects to the configured frontend URL.
      responses:
        '200':
          description: GitHub OAuth URL to open in browser
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GithubInstallResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/github/callback:
    get:
      operationId: handleGithubCallback
      summary: Handle GitHub OAuth callback
      description: Processes the OAuth callback from GitHub, exchanges code for tokens, and stores installation
      tags: [GitHub]
      security: []  # Auth happens via code exchange
      parameters:
        - name: code
          in: query
          required: true
          schema:
            type: string
          description: OAuth authorization code from GitHub
        - name: installation_id
          in: query
          required: false
          schema:
            type: integer
          description: GitHub App installation ID (only present during app installation flow)
        - name: setup_action
          in: query
          required: false
          schema:
            type: string
          description: Setup action (install/update)
        - name: state
          in: query
          required: false
          schema:
            type: string
          description: CSRF protection state parameter
      responses:
        '302':
          description: Redirect to frontend with success/error status
          headers:
            Location:
              schema:
                type: string
                example: https://app.specflux.ai/settings/integrations?github=success
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/github/status:
    get:
      operationId: getGithubInstallationStatus
      summary: Get GitHub installation status
      description: Check if the current user has installed the GitHub App
      tags: [GitHub]
      responses:
        '200':
          description: GitHub installation status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GithubInstallationStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/github/disconnect:
    delete:
      operationId: disconnectGithubInstallation
      summary: Disconnect GitHub installation
      description: Removes the GitHub App installation for the current user
      tags: [GitHub]
      responses:
        '204':
          description: GitHub installation disconnected successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/github/repos:
    get:
      operationId: listGithubRepos
      summary: List user's GitHub repositories
      description: Returns repositories owned by the authenticated user's GitHub account
      tags: [GitHub]
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number for pagination
        - name: per_page
          in: query
          required: false
          schema:
            type: integer
            default: 30
            minimum: 1
            maximum: 100
          description: Number of repositories per page (max 100)
      responses:
        '200':
          description: List of GitHub repositories
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GithubRepoListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: GitHub not connected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      operationId: createGithubRepo
      summary: Create a new GitHub repository
      description: Creates a new repository on GitHub for the authenticated user
      tags: [GitHub]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGithubRepoRequest'
      responses:
        '201':
          description: Repository created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GithubRepo'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: GitHub not connected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Repository name already exists or is invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/github/repos/{owner}/{repo}/exists:
    get:
      operationId: checkGithubRepoExists
      summary: Check if a GitHub repository exists
      description: |
        Checks if the specified repository exists on GitHub and is accessible
        to the authenticated user. Returns 200 with exists=true if found,
        or exists=false if not found or not accessible.
      tags: [GitHub]
      parameters:
        - name: owner
          in: path
          required: true
          schema:
            type: string
          description: Repository owner (username or organization)
        - name: repo
          in: path
          required: true
          schema:
            type: string
          description: Repository name
      responses:
        '200':
          description: Repository existence check result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GithubRepoExistsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: GitHub not connected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/github/repos/{owner}/{repo}:
    delete:
      operationId: deleteGithubRepo
      summary: Delete a GitHub repository
      description: |
        Permanently deletes the specified repository from GitHub.
        This action is irreversible. Requires delete_repo scope.
      tags: [GitHub]
      parameters:
        - name: owner
          in: path
          required: true
          schema:
            type: string
          description: Repository owner (username or organization)
        - name: repo
          in: path
          required: true
          schema:
            type: string
          description: Repository name
      responses:
        '204':
          description: Repository deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: No permission to delete repository
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Repository not found or GitHub not connected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ==================== API KEYS ====================
  /api/users/me/api-keys:
    get:
      operationId: listApiKeys
      summary: List user's API keys
      description: Returns all API keys for the authenticated user. Secret keys are masked.
      tags: [ApiKeys]
      responses:
        '200':
          description: List of API keys
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ApiKeyResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      operationId: createApiKey
      summary: Create a new API key
      description: |
        Creates a new API key. The full secret is only returned once at creation time.
        Users can only have one active API key at a time.
      tags: [ApiKeys]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateApiKeyRequest'
      responses:
        '201':
          description: API key created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyCreatedResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: User already has an active API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/users/me/api-keys/{keyId}:
    parameters:
      - name: keyId
        in: path
        required: true
        schema:
          type: string
        description: API key public ID
    delete:
      operationId: revokeApiKey
      summary: Revoke an API key
      description: Permanently revokes the specified API key. The key cannot be used for authentication after revocation.
      tags: [ApiKeys]
      responses:
        '204':
          description: API key revoked
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Key does not belong to user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    CursorParam:
      name: cursor
      in: query
      description: Base64-encoded pagination cursor
      schema:
        type: string

    LimitParam:
      name: limit
      in: query
      description: Items per page (default 20, max 100)
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

    SortParam:
      name: sort
      in: query
      schema:
        type: string
        enum: [created_at, updated_at, title]
        default: created_at

    OrderParam:
      name: order
      in: query
      schema:
        type: string
        enum: [asc, desc]
        default: desc

  responses:
    BadRequest:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Conflict:
      description: Resource already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    # Common
    ErrorResponse:
      type: object
      required: [error, code]
      properties:
        error:
          type: string
        code:
          type: string
        details:
          type: array
          items:
            $ref: '#/components/schemas/FieldError'

    FieldError:
      type: object
      properties:
        field:
          type: string
        message:
          type: string

    CursorPagination:
      type: object
      properties:
        nextCursor:
          type: string
          nullable: true
        prevCursor:
          type: string
          nullable: true
        hasMore:
          type: boolean
        total:
          type: integer
          format: int64

    # API Keys
    ApiKeyResponse:
      type: object
      required: [id, keyPrefix, createdAt, isExpired, isRevoked]
      properties:
        id:
          type: string
          description: Unique API key public identifier
        name:
          type: string
          nullable: true
          description: Human-readable name for the key
        keyPrefix:
          type: string
          description: Masked prefix of the key (e.g., sfx_abc...)
        createdAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
          nullable: true
        lastUsedAt:
          type: string
          format: date-time
          nullable: true
        isExpired:
          type: boolean
        isRevoked:
          type: boolean

    CreateApiKeyRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
          description: Human-readable name for the API key
        expiresAt:
          type: string
          format: date-time
          description: Optional expiration timestamp

    ApiKeyCreatedResponse:
      type: object
      required: [id, key, keyPrefix, createdAt]
      properties:
        id:
          type: string
          description: Unique API key public identifier
        key:
          type: string
          description: The full API key secret. Only shown once at creation time.
        name:
          type: string
          nullable: true
          description: Human-readable name for the key
        keyPrefix:
          type: string
          description: Masked prefix of the key
        createdAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
          nullable: true

    # Project
    Project:
      type: object
      required: [id, projectKey, name, ownerId, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., proj_abc123xyz789)
        projectKey:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        localPath:
          type: string
          nullable: true
          description: Local filesystem path to project directory
        ownerId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateProjectRequest:
      type: object
      required: [projectKey, name]
      properties:
        projectKey:
          type: string
          minLength: 2
          maxLength: 10
          pattern: '^[A-Z0-9]+$'
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        localPath:
          type: string
          nullable: true
          maxLength: 1000
          description: Local filesystem path to project directory

    UpdateProjectRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        localPath:
          type: string
          nullable: true
          maxLength: 1000
          description: Local filesystem path to project directory

    ProjectListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Project'
        pagination:
          $ref: '#/components/schemas/CursorPagination'

    # PRD
    PrdStatus:
      type: string
      enum: [DRAFT, IN_REVIEW, APPROVED, IMPLEMENTED, ARCHIVED]

    PrdDocumentType:
      type: string
      enum: [PRD, WIREFRAME, MOCKUP, DESIGN, OTHER]

    PrdDocument:
      type: object
      required: [id, fileName, filePath, documentType, isPrimary, orderIndex, createdAt]
      properties:
        id:
          type: integer
          format: int64
        fileName:
          type: string
          description: File name (e.g., prd.md, wireframe.png)
        filePath:
          type: string
          description: Path relative to project root
        documentType:
          $ref: '#/components/schemas/PrdDocumentType'
        isPrimary:
          type: boolean
          description: Whether this is the main PRD document
        orderIndex:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Prd:
      type: object
      required: [id, displayKey, projectId, title, folderPath, status, createdById, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., prd_xyz789abc123)
        displayKey:
          type: string
          description: Display key (e.g., SPEC-P1)
        projectId:
          type: string
        title:
          type: string
        description:
          type: string
          nullable: true
        folderPath:
          type: string
          description: Path to PRD folder (e.g., .specflux/prds/auth-system)
        status:
          $ref: '#/components/schemas/PrdStatus'
        documents:
          type: array
          items:
            $ref: '#/components/schemas/PrdDocument'
          description: List of documents in this PRD
        documentCount:
          type: integer
          description: Number of documents in this PRD
        createdById:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreatePrdRequest:
      type: object
      required: [title]
      properties:
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        folderPath:
          type: string
          nullable: true
          maxLength: 500
          description: Path to PRD folder. Auto-generated from title if not provided.

    UpdatePrdRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/PrdStatus'

    AddPrdDocumentRequest:
      type: object
      required: [fileName, filePath]
      properties:
        fileName:
          type: string
          maxLength: 255
        filePath:
          type: string
          maxLength: 500
          description: Path relative to project root
        documentType:
          $ref: '#/components/schemas/PrdDocumentType'
        isPrimary:
          type: boolean
          default: false
        orderIndex:
          type: integer
          nullable: true
          description: Display order. Auto-incremented if not provided.

    UpdatePrdDocumentRequest:
      type: object
      properties:
        documentType:
          $ref: '#/components/schemas/PrdDocumentType'
        isPrimary:
          type: boolean
        orderIndex:
          type: integer

    PrdListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Prd'
        pagination:
          $ref: '#/components/schemas/CursorPagination'

    # Epic
    EpicStatus:
      type: string
      enum: [PLANNING, IN_PROGRESS, BLOCKED, COMPLETED, CANCELLED]

    TaskStats:
      type: object
      properties:
        total:
          type: integer
        done:
          type: integer
        inProgress:
          type: integer
        backlog:
          type: integer
      required:
        - total
        - done
        - inProgress
        - backlog

    Epic:
      type: object
      required: [id, displayKey, projectId, title, status, createdById, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., epic_xyz789abc123)
        displayKey:
          type: string
        projectId:
          type: string
        releaseId:
          type: string
          nullable: true
          description: Public ID of the associated release
        title:
          type: string
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/EpicStatus'
        targetDate:
          type: string
          format: date
          nullable: true
        prdId:
          type: string
          nullable: true
          description: Public ID of the associated PRD
        prdFilePath:
          type: string
          nullable: true
          description: Path to the PRD document (deprecated, use prdId)
        epicFilePath:
          type: string
          nullable: true
          description: Path to the epic document
        notes:
          type: string
          nullable: true
          description: Internal notes about the epic for session handoff
        dependsOn:
          type: array
          items:
            type: string
          description: List of epic public IDs this epic depends on
        phase:
          type: integer
          minimum: 1
          description: Computed phase based on dependency depth
        taskStats:
          $ref: '#/components/schemas/TaskStats'
        progressPercentage:
          type: integer
          minimum: 0
          maximum: 100
          description: Completion percentage based on task completion
        createdById:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateEpicRequest:
      type: object
      required: [title, acceptanceCriteria]
      properties:
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        targetDate:
          type: string
          format: date
          nullable: true
        releaseRef:
          type: string
          nullable: true
          description: Release publicId or displayKey to assign
        prdRef:
          type: string
          nullable: true
          description: PRD publicId or displayKey to link
        prdFilePath:
          type: string
          nullable: true
          maxLength: 500
          description: Path to the PRD document (deprecated, use prdRef)
        acceptanceCriteria:
          type: array
          description: List of acceptance criteria (at least one required)
          minItems: 1
          items:
            type: object
            required: [criteria]
            properties:
              criteria:
                type: string
                minLength: 1
                maxLength: 2000

    UpdateEpicRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/EpicStatus'
        targetDate:
          type: string
          format: date
          nullable: true
        releaseRef:
          type: string
          nullable: true
          description: Release publicId or displayKey to assign
        prdRef:
          type: string
          nullable: true
          description: PRD publicId or displayKey to link
        prdFilePath:
          type: string
          nullable: true
          maxLength: 500
          description: Path to the PRD document (deprecated, use prdRef)
        notes:
          type: string
          nullable: true
          description: Internal notes about the epic for session handoff

    EpicListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Epic'
        pagination:
          $ref: '#/components/schemas/CursorPagination'

    # Task
    TaskStatus:
      type: string
      enum: [BACKLOG, READY, IN_PROGRESS, IN_REVIEW, BLOCKED, COMPLETED, CANCELLED]

    TaskPriority:
      type: string
      enum: [LOW, MEDIUM, HIGH, CRITICAL]

    Task:
      type: object
      required: [id, displayKey, projectId, title, status, priority, requiresApproval, createdById, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., task_def456ghi789)
        displayKey:
          type: string
        projectId:
          type: string
        epicId:
          type: string
          nullable: true
        epicDisplayKey:
          type: string
          nullable: true
        title:
          type: string
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/TaskStatus'
        priority:
          $ref: '#/components/schemas/TaskPriority'
        requiresApproval:
          type: boolean
        estimatedDuration:
          type: integer
          nullable: true
        actualDuration:
          type: integer
          nullable: true
        githubPrUrl:
          type: string
          nullable: true
        createdById:
          type: string
        assignedToId:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateTaskRequest:
      type: object
      required: [title]
      properties:
        epicRef:
          type: string
          nullable: true
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        priority:
          $ref: '#/components/schemas/TaskPriority'
        requiresApproval:
          type: boolean
          default: true
        estimatedDuration:
          type: integer
          nullable: true
        assignedToRef:
          type: string
          nullable: true

    UpdateTaskRequest:
      type: object
      properties:
        epicRef:
          type: string
          nullable: true
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/TaskStatus'
        priority:
          $ref: '#/components/schemas/TaskPriority'
        requiresApproval:
          type: boolean
        estimatedDuration:
          type: integer
          nullable: true
        actualDuration:
          type: integer
          nullable: true
        githubPrUrl:
          type: string
          nullable: true
        assignedToRef:
          type: string
          nullable: true

    TaskListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Task'
        pagination:
          $ref: '#/components/schemas/CursorPagination'

    # Release
    ReleaseStatus:
      type: string
      enum: [PLANNED, IN_PROGRESS, RELEASED, CANCELLED]

    Release:
      type: object
      required: [id, displayKey, projectId, name, status, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., rel_abc123xyz789)
        displayKey:
          type: string
        projectId:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        targetDate:
          type: string
          format: date
          nullable: true
        status:
          $ref: '#/components/schemas/ReleaseStatus'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateReleaseRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        targetDate:
          type: string
          format: date
          nullable: true

    UpdateReleaseRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/ReleaseStatus'
        targetDate:
          type: string
          format: date
          nullable: true

    ReleaseListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Release'
        pagination:
          $ref: '#/components/schemas/CursorPagination'

    ReleaseWithEpics:
      description: Release with optionally nested epics and tasks (based on include parameter)
      type: object
      required: [id, displayKey, projectId, name, status, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., rel_abc123xyz789)
        displayKey:
          type: string
        projectId:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        targetDate:
          type: string
          format: date
          nullable: true
        status:
          $ref: '#/components/schemas/ReleaseStatus'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        epics:
          type: array
          nullable: true
          description: Nested epics (present when include=epics)
          items:
            $ref: '#/components/schemas/EpicWithTasks'

    EpicWithTasks:
      description: Epic with optionally nested tasks (based on include parameter)
      type: object
      required: [id, displayKey, projectId, title, status, createdById, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., epic_xyz789abc123)
        displayKey:
          type: string
        projectId:
          type: string
        releaseId:
          type: string
          nullable: true
        title:
          type: string
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/EpicStatus'
        targetDate:
          type: string
          format: date
          nullable: true
        prdId:
          type: string
          nullable: true
        prdFilePath:
          type: string
          nullable: true
        epicFilePath:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true
          description: Internal notes about the epic for session handoff
        dependsOn:
          type: array
          items:
            type: string
        phase:
          type: integer
          minimum: 1
        taskStats:
          $ref: '#/components/schemas/TaskStats'
        progressPercentage:
          type: integer
          minimum: 0
          maximum: 100
        createdById:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        tasks:
          type: array
          nullable: true
          description: Nested tasks (present when include=epics,tasks)
          items:
            $ref: '#/components/schemas/TaskWithCriteria'

    TaskWithCriteria:
      description: Task with nested acceptance criteria
      type: object
      required: [id, displayKey, projectId, title, status, priority, requiresApproval, createdById, createdAt, updatedAt]
      properties:
        id:
          type: string
        displayKey:
          type: string
        projectId:
          type: string
        epicId:
          type: string
          nullable: true
        epicDisplayKey:
          type: string
          nullable: true
        title:
          type: string
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/TaskStatus'
        priority:
          $ref: '#/components/schemas/TaskPriority'
        requiresApproval:
          type: boolean
        estimatedDuration:
          type: string
          nullable: true
        actualDuration:
          type: string
          nullable: true
        assignedToId:
          type: string
          nullable: true
        githubPrUrl:
          type: string
          nullable: true
        createdById:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        acceptanceCriteria:
          type: array
          description: List of acceptance criteria for this task
          items:
            $ref: '#/components/schemas/AcceptanceCriteria'

    # Task Dependency
    TaskDependency:
      type: object
      required: [taskId, dependsOnTaskId, dependsOnDisplayKey, createdAt]
      properties:
        taskId:
          type: string
          description: Public ID of the task that has the dependency
        dependsOnTaskId:
          type: string
          description: Public ID of the task that this task depends on
        dependsOnDisplayKey:
          type: string
          description: Display key of the task that this task depends on
        createdAt:
          type: string
          format: date-time

    AddTaskDependencyRequest:
      type: object
      required: [dependsOnTaskRef]
      properties:
        dependsOnTaskRef:
          type: string
          description: Task reference (publicId or displayKey) that this task depends on

    TaskDependencyListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/TaskDependency'

    # Acceptance Criteria
    AcceptanceCriteria:
      type: object
      required: [id, criteria, isMet, orderIndex, createdAt]
      properties:
        id:
          type: integer
          format: int64
        criteria:
          type: string
        isMet:
          type: boolean
        orderIndex:
          type: integer
        createdAt:
          type: string
          format: date-time

    CreateAcceptanceCriteriaRequest:
      type: object
      required: [criteria]
      properties:
        criteria:
          type: string
          minLength: 1
          maxLength: 2000
        orderIndex:
          type: integer
          nullable: true
          description: Order index for display. If not provided, auto-increments based on existing criteria count.

    UpdateAcceptanceCriteriaRequest:
      type: object
      properties:
        criteria:
          type: string
          minLength: 1
          maxLength: 2000
        isMet:
          type: boolean
        orderIndex:
          type: integer

    AcceptanceCriteriaListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/AcceptanceCriteria'

    # Users
    User:
      type: object
      required: [id, email, displayName, createdAt]
      properties:
        id:
          type: string
          description: Unique user identifier (e.g., usr_abc123def456)
          example: usr_abc123def456
        email:
          type: string
          format: email
          description: User's email address from OAuth provider
        displayName:
          type: string
          description: User's display name
          example: John Doe
        avatarUrl:
          type: string
          nullable: true
          description: URL to user's avatar image
          example: https://avatars.githubusercontent.com/u/12345
        createdAt:
          type: string
          format: date-time
          description: When the user account was created

    UpdateUserRequest:
      type: object
      properties:
        displayName:
          type: string
          minLength: 1
          maxLength: 100
          description: New display name
        avatarUrl:
          type: string
          nullable: true
          maxLength: 500
          description: New avatar URL (null to remove)

    # Repository
    RepositoryStatus:
      type: string
      enum: [READY, SYNCING, ERROR]

    Repository:
      type: object
      required: [id, projectId, name, path, status, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., repo_abc123xyz789)
        projectId:
          type: string
        name:
          type: string
        path:
          type: string
          description: Local filesystem path to repository
        gitUrl:
          type: string
          nullable: true
        defaultBranch:
          type: string
        status:
          $ref: '#/components/schemas/RepositoryStatus'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateRepositoryRequest:
      type: object
      required: [name, path]
      properties:
        name:
          type: string
          maxLength: 255
        path:
          type: string
          maxLength: 1000
        gitUrl:
          type: string
          nullable: true
          maxLength: 500
        defaultBranch:
          type: string
          maxLength: 100

    UpdateRepositoryRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        gitUrl:
          type: string
          nullable: true
          maxLength: 500
        defaultBranch:
          type: string
          maxLength: 100
        status:
          $ref: '#/components/schemas/RepositoryStatus'

    RepositoryListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Repository'

    # Skill
    Skill:
      type: object
      required: [id, projectId, name, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., skill_abc123xyz789)
        projectId:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        folderPath:
          type: string
          nullable: true
          description: Path to skill folder in .claude/skills/
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateSkillRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        folderPath:
          type: string
          nullable: true
          maxLength: 1000

    UpdateSkillRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        folderPath:
          type: string
          nullable: true
          maxLength: 1000

    SkillListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Skill'

    # Agent
    Agent:
      type: object
      required: [id, projectId, name, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., agent_abc123xyz789)
        projectId:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        filePath:
          type: string
          nullable: true
          description: Path to agent file in .claude/agents/
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateAgentRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        filePath:
          type: string
          nullable: true
          maxLength: 1000

    UpdateAgentRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        filePath:
          type: string
          nullable: true
          maxLength: 1000

    AgentListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Agent'

    # MCP Server
    McpServer:
      type: object
      required: [id, projectId, name, command, isActive, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Unique identifier (e.g., mcp_abc123xyz789)
        projectId:
          type: string
        name:
          type: string
        command:
          type: string
          description: Command to run the MCP server
        args:
          type: array
          items:
            type: string
          description: Command arguments
        envVars:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Environment variables
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateMcpServerRequest:
      type: object
      required: [name, command]
      properties:
        name:
          type: string
          maxLength: 255
        command:
          type: string
          maxLength: 500
        args:
          type: array
          items:
            type: string
        envVars:
          type: object
          additionalProperties:
            type: string
          nullable: true
        isActive:
          type: boolean
          default: true

    UpdateMcpServerRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        command:
          type: string
          maxLength: 500
        args:
          type: array
          items:
            type: string
        envVars:
          type: object
          additionalProperties:
            type: string
          nullable: true
        isActive:
          type: boolean

    McpServerListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/McpServer'

    # GitHub
    GithubInstallResponse:
      type: object
      required: [authUrl]
      properties:
        authUrl:
          type: string
          format: uri
          description: GitHub OAuth URL to open in browser
          example: https://github.com/login/oauth/authorize?client_id=xxx&redirect_uri=xxx&scope=repo&state=xxx

    GithubInstallationStatus:
      type: object
      required: [installed]
      properties:
        installed:
          type: boolean
          description: Whether the user has installed the GitHub App
          example: true
        githubUsername:
          type: string
          nullable: true
          description: GitHub username (only present if installed)
          example: octocat
        connectedAt:
          type: string
          format: date-time
          nullable: true
          description: When the GitHub App was installed
          example: '2024-01-15T10:30:00Z'

    GithubRepo:
      type: object
      required: [id, name, fullName, private, htmlUrl, cloneUrl]
      properties:
        id:
          type: integer
          format: int64
          description: GitHub repository ID
          example: 123456789
        name:
          type: string
          description: Repository name
          example: my-project
        fullName:
          type: string
          description: Full repository name (owner/repo)
          example: octocat/my-project
        description:
          type: string
          nullable: true
          description: Repository description
          example: A sample project
        private:
          type: boolean
          description: Whether the repository is private
          example: true
        htmlUrl:
          type: string
          format: uri
          description: GitHub web URL for the repository
          example: https://github.com/octocat/my-project
        cloneUrl:
          type: string
          format: uri
          description: HTTPS clone URL
          example: https://github.com/octocat/my-project.git

    GithubRepoListResponse:
      type: object
      required: [repos, totalCount, page, perPage]
      properties:
        repos:
          type: array
          items:
            $ref: '#/components/schemas/GithubRepo'
          description: List of GitHub repositories
        totalCount:
          type: integer
          description: Total number of repositories (approximate)
          example: 42
        page:
          type: integer
          description: Current page number
          example: 1
        perPage:
          type: integer
          description: Number of repositories per page
          example: 30

    CreateGithubRepoRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          description: Repository name (alphanumeric with hyphens and underscores)
          example: my-new-project
          minLength: 1
          maxLength: 100
        description:
          type: string
          nullable: true
          description: Repository description
          example: A new project created from SpecFlux
        private:
          type: boolean
          default: true
          description: Whether the repository should be private
          example: true

    GithubRepoExistsResponse:
      type: object
      required: [exists]
      properties:
        exists:
          type: boolean
          description: Whether the repository exists and is accessible
          example: true
