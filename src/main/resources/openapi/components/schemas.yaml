components:
  schemas:
    # Pagination
    CursorPagination:
      type: object
      properties:
        nextCursor:
          type: string
          nullable: true
          description: Base64-encoded cursor for next page
          example: "eyJpZCI6MTAsInNvcnRWYWx1ZSI6IjIwMjQtMTItMDFUMTQ6MzA6MDBaIn0="
        prevCursor:
          type: string
          nullable: true
          description: Base64-encoded cursor for previous page
        hasMore:
          type: boolean
          description: Whether more results exist
        total:
          type: integer
          format: int64
          description: Total count matching filters

    # Project
    Project:
      type: object
      properties:
        publicId:
          type: string
          example: "proj_abc123xyz789"
        projectKey:
          type: string
          minLength: 2
          maxLength: 10
          pattern: "^[A-Z0-9]+$"
          example: "SPEC"
        name:
          type: string
          maxLength: 255
          example: "SpecFlux"
        description:
          type: string
          nullable: true
          example: "AI-powered project management"
        ownerId:
          type: string
          example: "user_abc123"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - publicId
        - projectKey
        - name
        - ownerId
        - createdAt
        - updatedAt

    CreateProjectRequest:
      type: object
      properties:
        projectKey:
          type: string
          minLength: 2
          maxLength: 10
          pattern: "^[A-Z0-9]+$"
          example: "SPEC"
        name:
          type: string
          maxLength: 255
          example: "SpecFlux"
        description:
          type: string
          nullable: true
          example: "AI-powered project management"
      required:
        - projectKey
        - name

    UpdateProjectRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true

    ProjectListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Project'
        pagination:
          $ref: '#/components/schemas/CursorPagination'

    # Epic
    EpicStatus:
      type: string
      enum: [PLANNING, IN_PROGRESS, BLOCKED, COMPLETED, CANCELLED]

    TaskStats:
      type: object
      properties:
        total:
          type: integer
          example: 10
        done:
          type: integer
          example: 5
        inProgress:
          type: integer
          example: 2
        backlog:
          type: integer
          example: 3
      required:
        - total
        - done
        - inProgress
        - backlog

    Epic:
      type: object
      properties:
        publicId:
          type: string
          example: "epic_xyz789abc123"
        displayKey:
          type: string
          example: "SPEC-E1"
        projectId:
          type: string
          example: "proj_abc123"
        releaseId:
          type: string
          nullable: true
          example: "rel_abc123"
          description: Public ID of the associated release
        title:
          type: string
          example: "User Authentication"
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/EpicStatus'
        targetDate:
          type: string
          format: date
          nullable: true
        prdFilePath:
          type: string
          nullable: true
          example: "/docs/prd/auth.md"
          description: Path to the PRD document
        epicFilePath:
          type: string
          nullable: true
          example: "/docs/epics/auth.md"
          description: Path to the epic document
        dependsOn:
          type: array
          items:
            type: string
          description: List of epic public IDs this epic depends on
          example: ["epic_abc123", "epic_def456"]
        phase:
          type: integer
          minimum: 1
          description: Computed phase based on dependency depth
          example: 1
        taskStats:
          $ref: '#/components/schemas/TaskStats'
        progressPercentage:
          type: integer
          minimum: 0
          maximum: 100
          description: Completion percentage based on task completion
          example: 50
        createdById:
          type: string
          example: "user_abc123"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - publicId
        - displayKey
        - projectId
        - title
        - status
        - createdById
        - createdAt
        - updatedAt

    CreateEpicRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        targetDate:
          type: string
          format: date
          nullable: true
        releaseRef:
          type: string
          nullable: true
          description: Release publicId or displayKey to assign
        prdFilePath:
          type: string
          nullable: true
          maxLength: 500
          description: Path to the PRD document
      required:
        - title

    UpdateEpicRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/EpicStatus'
        targetDate:
          type: string
          format: date
          nullable: true
        releaseRef:
          type: string
          nullable: true
          description: Release publicId or displayKey to assign
        prdFilePath:
          type: string
          nullable: true
          maxLength: 500
          description: Path to the PRD document

    EpicListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Epic'
        pagination:
          $ref: '#/components/schemas/CursorPagination'

    # Task
    TaskStatus:
      type: string
      enum: [BACKLOG, READY, IN_PROGRESS, IN_REVIEW, BLOCKED, COMPLETED, CANCELLED]

    TaskPriority:
      type: string
      enum: [LOW, MEDIUM, HIGH, CRITICAL]

    Task:
      type: object
      properties:
        publicId:
          type: string
          example: "task_def456ghi789"
        displayKey:
          type: string
          example: "SPEC-42"
        projectId:
          type: string
          example: "proj_abc123"
        epicId:
          type: string
          nullable: true
          example: "epic_xyz789"
        epicDisplayKey:
          type: string
          nullable: true
          example: "SPEC-E1"
        title:
          type: string
          example: "Implement login flow"
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/TaskStatus'
        priority:
          $ref: '#/components/schemas/TaskPriority'
        requiresApproval:
          type: boolean
          default: true
        estimatedDuration:
          type: integer
          nullable: true
          description: Estimated duration in minutes
        actualDuration:
          type: integer
          nullable: true
          description: Actual duration in minutes
        githubPrUrl:
          type: string
          nullable: true
        createdById:
          type: string
          example: "user_abc123"
        assignedToId:
          type: string
          nullable: true
          example: "user_def456"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - publicId
        - displayKey
        - projectId
        - title
        - status
        - priority
        - requiresApproval
        - createdById
        - createdAt
        - updatedAt

    CreateTaskRequest:
      type: object
      properties:
        epicRef:
          type: string
          nullable: true
          description: Epic publicId or displayKey
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        priority:
          $ref: '#/components/schemas/TaskPriority'
        requiresApproval:
          type: boolean
          default: true
        estimatedDuration:
          type: integer
          nullable: true
        assignedToRef:
          type: string
          nullable: true
          description: User publicId to assign
      required:
        - title

    UpdateTaskRequest:
      type: object
      properties:
        epicRef:
          type: string
          nullable: true
        title:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/TaskStatus'
        priority:
          $ref: '#/components/schemas/TaskPriority'
        requiresApproval:
          type: boolean
        estimatedDuration:
          type: integer
          nullable: true
        actualDuration:
          type: integer
          nullable: true
        githubPrUrl:
          type: string
          nullable: true
        assignedToRef:
          type: string
          nullable: true

    TaskListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Task'
        pagination:
          $ref: '#/components/schemas/CursorPagination'

    # Release
    ReleaseStatus:
      type: string
      enum: [PLANNED, IN_PROGRESS, RELEASED, CANCELLED]

    Release:
      type: object
      properties:
        publicId:
          type: string
          example: "rel_abc123xyz789"
        displayKey:
          type: string
          example: "SPEC-R1"
        projectId:
          type: string
          example: "proj_abc123"
        name:
          type: string
          example: "v1.0.0"
        description:
          type: string
          nullable: true
        targetDate:
          type: string
          format: date
          nullable: true
        status:
          $ref: '#/components/schemas/ReleaseStatus'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - publicId
        - displayKey
        - projectId
        - name
        - status
        - createdAt
        - updatedAt

    CreateReleaseRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        targetDate:
          type: string
          format: date
          nullable: true
      required:
        - name

    UpdateReleaseRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        description:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/ReleaseStatus'
        targetDate:
          type: string
          format: date
          nullable: true

    ReleaseListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Release'
        pagination:
          $ref: '#/components/schemas/CursorPagination'
